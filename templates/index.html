<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<title>{{ app_name }}</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
:root{
  --bg: #07070a;
  --card: #0f0f14;
  --card2: #0b0b10;
  --text: #f5f5f7;
  --muted: #a1a1aa;
  --border: rgba(255,255,255,.10);
  --red: #ff2a2a;
  --red2:#b60000;
  --green:#2ee59d;
  --radius: 16px;
  --shadow: 0 14px 35px rgba(0,0,0,.45);
}

*{ box-sizing:border-box; }

body{
  font-family:-apple-system, BlinkMacSystemFont, "Inter", "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  background: radial-gradient(1200px 600px at 15% 0%, rgba(255,42,42,.14), transparent 55%),
              radial-gradient(900px 600px at 85% 0%, rgba(255,42,42,.10), transparent 55%),
              var(--bg);
  color: var(--text);
  padding: 34px 18px;
  max-width: 1060px;
  margin: 0 auto;
  line-height: 1.55;
}

a{ color: var(--text); text-decoration:none; }
a:hover{ text-decoration:underline; }

header{
  display:flex; justify-content:space-between; align-items:flex-end; gap:14px;
  margin-bottom: 18px;
}

h1{
  font-size: 28px;
  margin:0;
  letter-spacing: -0.4px;
}

.meta{ color: var(--muted); font-size: 14px; margin-top:6px; }

.pill{
  display:inline-flex; gap:8px; align-items:center;
  padding: 8px 12px;
  border-radius: 999px;
  background: rgba(255,42,42,.10);
  border: 1px solid rgba(255,42,42,.25);
  color: #ffd0d0;
  font-size: 12px;
  white-space: nowrap;
}

.pill b{ color:#fff; }

.top-grid{
  display:grid;
  grid-template-columns: 1.1fr .9fr;
  gap: 14px;
  margin: 14px 0 18px;
}

@media (max-width: 900px){
  .top-grid{ grid-template-columns: 1fr; }
}

.panel{
  background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 16px;
  box-shadow: var(--shadow);
}

.panel h3{
  margin:0 0 8px 0;
  font-size: 14px;
  letter-spacing: .2px;
  color: #fff;
}

.feed{
  display:flex; flex-direction:column; gap:10px;
}

.feed-item{
  display:flex; gap:10px;
  padding: 12px;
  border-radius: 14px;
  background: rgba(255,255,255,.02);
  border: 1px solid rgba(255,255,255,.06);
}

.dot{
  width:10px; height:10px; border-radius:99px;
  background: var(--red);
  box-shadow: 0 0 0 6px rgba(255,42,42,.12);
  margin-top: 4px;
}

.feed-item .t{
  font-size: 13px;
  color: #eaeaf0;
}
.feed-item .s{
  font-size: 12px;
  color: var(--muted);
  margin-top: 2px;
}

form{
  display:flex;
  gap: 10px;
  flex-wrap: wrap;
  margin: 0;
}

input{
  flex:1;
  min-width: 220px;
  padding: 12px 14px;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,.12);
  background: rgba(0,0,0,.35);
  color: var(--text);
  font-size: 14px;
}

input:focus{
  outline:none;
  border-color: rgba(255,42,42,.55);
  box-shadow: 0 0 0 4px rgba(255,42,42,.15);
}

button{
  padding: 12px 16px;
  border-radius: 12px;
  border: 1px solid rgba(255,42,42,.40);
  background: linear-gradient(180deg, rgba(255,42,42,.95), rgba(182,0,0,.95));
  color:#fff;
  font-weight: 800;
  cursor:pointer;
  transition: transform .06s ease, opacity .2s ease;
}

button:hover{ opacity: .93; }
button:active{ transform: scale(.98); }

.sub-actions{
  display:flex; gap:10px; align-items:center; flex-wrap:wrap;
  margin-top: 10px;
}

.link-btn{
  display:inline-flex; align-items:center; gap:8px;
  padding: 10px 12px;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,.10);
  background: rgba(255,255,255,.04);
  color:#fff;
  font-size: 13px;
}

.scoreboard{
  display:grid;
  grid-template-columns: 1.3fr 1fr;
  gap: 12px;
  align-items: stretch;
}

@media (max-width: 700px){
  .scoreboard{ grid-template-columns: 1fr; }
}

.big-score{
  background: rgba(255,42,42,.08);
  border: 1px solid rgba(255,42,42,.25);
  border-radius: 16px;
  padding: 16px;
}

.big-score .k{
  color: #ffd0d0;
  font-size: 12px;
}
.big-score .v{
  font-size: 34px;
  font-weight: 900;
  letter-spacing: -0.8px;
  margin-top: 3px;
}
.big-score .hint{
  color: var(--muted);
  font-size: 13px;
  margin-top: 6px;
}

.breakdown{
  display:grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 10px;
}

.stat{
  background: rgba(255,255,255,.02);
  border: 1px solid rgba(255,255,255,.08);
  border-radius: 14px;
  padding: 12px;
}
.stat .n{ font-size: 20px; font-weight: 900; }
.stat .l{ font-size: 12px; color: var(--muted); margin-top: 2px; }

.error{
  margin: 12px 0 0;
  padding: 12px 14px;
  border-radius: 14px;
  background: rgba(255,42,42,.12);
  border: 1px solid rgba(255,42,42,.25);
  color: #ffd0d0;
  font-weight: 600;
}

.grid{
  margin-top: 18px;
  display:grid;
  grid-template-columns: 1fr;
  gap: 14px;
}

.card{
  background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
  border: 1px solid rgba(255,255,255,.09);
  border-radius: var(--radius);
  padding: 18px;
  box-shadow: var(--shadow);
}

.card-head{
  display:flex; justify-content:space-between; gap:12px; align-items:flex-start; flex-wrap:wrap;
}

h2{
  margin:0;
  font-size: 18px;
  letter-spacing: -.2px;
}

.badge{
  display:inline-flex;
  padding: 6px 10px;
  border-radius: 999px;
  border: 1px solid rgba(255,42,42,.35);
  background: rgba(255,42,42,.10);
  color:#ffd0d0;
  font-size: 12px;
  font-weight: 800;
}

.row-meta{
  display:flex;
  gap:10px;
  flex-wrap: wrap;
  color: var(--muted);
  font-size: 13px;
  margin-top: 6px;
}

.score{
  color:#fff;
  font-weight: 900;
}

.section{
  margin-top: 14px;
  padding-top: 14px;
  border-top: 1px solid rgba(255,255,255,.08);
}

.label{
  font-weight: 900;
  font-size: 13px;
  margin-bottom: 8px;
  color: #fff;
  letter-spacing: .15px;
}

ul{ padding-left: 18px; margin: 8px 0; }
li{ margin-bottom: 6px; color:#e9e9ef; }

.note{
  border: 1px solid rgba(255,255,255,.10);
  background: rgba(0,0,0,.28);
  border-radius: 14px;
  padding: 12px;
}

.note pre{
  margin:0;
  white-space: pre-wrap;
  font-family: inherit;
  color: #f4f4fa;
  line-height: 1.55;
}

.note-head{
  display:flex; justify-content:space-between; align-items:center; gap:10px;
  margin-bottom: 8px;
  color: var(--muted);
  font-size: 12px;
}

.copy{
  background: rgba(255,255,255,.06);
  border: 1px solid rgba(255,255,255,.12);
  color:#fff;
  padding: 8px 10px;
  border-radius: 12px;
  cursor: pointer;
  font-weight: 800;
  font-size: 12px;
}

.copy:hover{ opacity: .9; }

.paywall{
  margin-top: 18px;
  text-align:center;
  padding: 22px;
  border-radius: var(--radius);
  border: 1px dashed rgba(255,42,42,.45);
  background: radial-gradient(600px 220px at 50% 0%, rgba(255,42,42,.18), transparent 65%),
              rgba(255,255,255,.02);
  box-shadow: var(--shadow);
}

.paywall h2{ font-size: 18px; margin:0; }
.paywall p{ color: var(--muted); margin: 8px 0 14px; }

.small{
  color: var(--muted);
  font-size: 12px;
  margin-top: 10px;
}

.locked-strip{
  display:flex; gap:10px; flex-wrap:wrap; justify-content:center;
  margin-top: 10px;
}
.lockpill{
  padding: 10px 12px;
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,.12);
  background: rgba(255,255,255,.03);
  color: rgba(255,255,255,.78);
  font-size: 12px;
}

#scannerOverlay{
  position:fixed;
  inset:0;
  background: rgba(0,0,0,.75);
  display:none;
  align-items:center;
  justify-content:center;
  z-index: 9999;
  padding: 18px;
}

.scannerBox{
  width: min(760px, 100%);
  border-radius: 18px;
  border: 1px solid rgba(255,255,255,.12);
  background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
  box-shadow: var(--shadow);
  padding: 18px;
}

.scannerTop{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;
  margin-bottom: 12px;
}

.scanTitle{
  font-weight: 900;
  letter-spacing: .2px;
}

.scanBar{
  height: 10px;
  border-radius: 999px;
  background: rgba(255,255,255,.08);
  overflow:hidden;
  border: 1px solid rgba(255,255,255,.10);
}

.scanBar > div{
  height:100%;
  width: 0%;
  background: linear-gradient(90deg, rgba(255,42,42,.9), rgba(255,42,42,.35));
  transition: width .3s ease;
}

@keyframes fill{
  from{ width: 6%; }
  to{ width: 100%; }
}

.scanSteps{
  display:grid;
  grid-template-columns: 1fr;
  gap: 10px;
  margin-top: 12px;
}

.step{
  display:flex;
  gap: 10px;
  padding: 12px;
  border-radius: 14px;
  border: 1px solid rgba(255,255,255,.08);
  background: rgba(0,0,0,.25);
  color: rgba(255,255,255,.86);
  font-size: 13px;
}

.step .b{
  width: 10px; height: 10px; border-radius: 999px;
  background: var(--red);
  box-shadow: 0 0 0 6px rgba(255,42,42,.12);
  margin-top: 4px;
}

.step.done .b{
  background: var(--green);
  box-shadow: 0 0 0 6px rgba(46,229,157,.12);
}
</style>
</head>

<body>

<div id="scannerOverlay">
  <div class="scannerBox">
    <div class="scannerTop">
      <div class="scanTitle">üî¥ Scanning your territory‚Ä¶</div>
      <div class="pill"><b>SignalZip</b> Intelligence Engine</div>
    </div>
    <div class="scanBar"><div></div></div>
    <div class="scanSteps" id="scanSteps">
      <div class="step"><div class="b"></div><div>Locating businesses by zip + industry‚Ä¶</div></div>
      <div class="step"><div class="b"></div><div>Scoring ‚Äúpayroll pain likelihood‚Äù (signals, not guesses)‚Ä¶</div></div>
      <div class="step"><div class="b"></div><div>Generating cold email + connection note you can copy‚Ä¶</div></div>
      <div class="step"><div class="b"></div><div>Mapping buying committee (LinkedIn jump links)‚Ä¶</div></div>
    </div>
    <div class="small">Tip: The free scan shows the top 3. Pro unlocks the full list + exports.</div>
  </div>
</div>

<header>
  <div>
    <h1>{{ app_name }}</h1>
    <div class="meta">Territory intelligence that feels curated ‚Äî not a giant list.</div>
  </div>

  <div class="pill">
    <span>Vertical:</span> <b>Payroll / HR</b>
  </div>
</header>

<div class="top-grid">
  <div class="panel">
    <h3>Live Territory Signals</h3>
    <div class="feed">
      <div class="feed-item">
        <div class="dot"></div>
        <div>
          <div class="t"><b>Fast Win:</b> Get 1 email + 1 LinkedIn note per account ‚Äî ready to copy.</div>
          <div class="s">No guessing. You leave with outreach text in seconds.</div>
        </div>
      </div>
      <div class="feed-item">
        <div class="dot"></div>
        <div>
          <div class="t"><b>Sniper Mode:</b> Top accounts are ranked first (avoid list fatigue).</div>
          <div class="s">You see priority, why, and the angle instantly.</div>
        </div>
      </div>
      <div class="feed-item">
        <div class="dot"></div>
        <div>
          <div class="t"><b>Decision Maker Jump:</b> Click into LinkedIn searches for the buying committee.</div>
          <div class="s">CEO/CFO/Ops/HR ‚Äî fast path to the right conversation.</div>
        </div>
      </div>
    </div>
  </div>

  <div class="panel">
    <h3>Scan My Territory</h3>
    <form method="post" action="/generate" id="scanForm">
      <input name="zip_codes" placeholder="Zip codes (comma separated) e.g., 75201, 75001" required />
      <input name="industry" placeholder="Industry (optional) e.g., construction" />
      <button type="submit">üî• Scan Territory</button>
    </form>

<div class="sub-actions">
  {% if is_premium %}
    <span class="pill"><b>Pro</b> active</span>

    <a class="link-btn" href="/export.csv">Export CSV</a>

    {% if email %}
    <form method="post" action="/billing-portal" style="display:inline;">
      <button type="submit" class="link-btn">Manage Billing</button>
    </form>
    {% endif %}

  {% else %}
    <span class="pill">Free scan: <b>Top 3</b></span>
  {% endif %}
</div>


    {% if error %}
      <div class="error">{{ error }}</div>
    {% endif %}
  </div>
</div>

{% if results and results|length > 0 %}
  <div class="panel">
    <h3>Territory Opportunity Scoreboard</h3>
    <div class="scoreboard">
      <div class="big-score">
        <div class="k">Territory Opportunity Score</div>
        <div class="v">{{ scoreboard.territory_score }} / 10</div>
        <div class="hint">Average priority across scanned accounts ‚Äî higher means better ‚Äúpayroll pain likelihood‚Äù.</div>
      </div>
      <div class="breakdown">
        <div class="stat">
          <div class="n">{{ scoreboard.high }}</div>
          <div class="l">High Signal (8‚Äì10)</div>
        </div>
        <div class="stat">
          <div class="n">{{ scoreboard.mid }}</div>
          <div class="l">Mid Signal (5‚Äì7)</div>
        </div>
        <div class="stat">
          <div class="n">{{ scoreboard.low }}</div>
          <div class="l">Low Signal (1‚Äì4)</div>
        </div>
      </div>
    </div>
  </div>

  <div class="grid">
    {% for r in results %}
  <div class="card">

  <div class="card-head" style="cursor:pointer;" onclick="toggleCard('card-{{ loop.index }}')">
    <div>
      <h2>{{ loop.index }}. {{ r.name }} ‚Äî <span class="score">{{ r.priority_score }} / 10</span></h2>
      <div class="row-meta">
        <span>{{ r.zip }}</span>
        {% if r.industry %}<span>‚Ä¢ {{ r.industry }}</span>{% endif %}
      </div>
    </div>

    <div>
      {% if r.signal_type == 'Growth' %}
        {% if loop.first %}
          <span class="badge">üî• Highest Growth</span>
        {% endif %}
      {% else %}
        <span class="badge">üî• {{ r.signal_type }} Signal</span>
      {% endif %}
    </div>
  </div>
 <div id="card-{{ loop.index }}" style="display:none; margin-top:16px;">

    <div class="section">
      <div class="label">Why this account matters</div>
      <div style="color: rgba(255,255,255,.86);">{{ r.reason }}</div>
    </div>

    <div class="section">
      <div class="label">Likely Decision Makers</div>
      <ul>
        {% for e in r.executives %}
          <li>
            <a href="{{ e.linkedin_url }}" target="_blank">{{ e.name }}</a> ‚Äî {{ e.title }}
          </li>
        {% endfor %}
      </ul>
    </div>

    <div class="section">
      <div class="label">Likely Payroll Pain Points</div>
      <ul>
        {% for p in r.pain_points %}
          <li>{{ p }}</li>
        {% endfor %}
      </ul>
    </div>

    <div class="section">
      <div class="label">Suggested Cold Email</div>
      <div class="note">
        <pre>Hi {{ r.name }} Team,

{{ r.email_draft }}

Best,
[Your Name]</pre>
      </div>
    </div>

    <div class="section">
      <div class="label">LinkedIn Connection Note</div>
      <div class="note">
        <pre>{{ r.linkedin_note }}</pre>
      </div>
    </div>

  </div>

</div>
    {% endfor %}
  </div>
{% endif %}

{% if not is_premium and locked_count > 0 %}
 <div class="paywall" id="pro-upgrade">
    <h2>üîí {{ locked_count }} More High-Signal Accounts Hidden</h2>
    <p>Pro unlocks the full ranked list + CSV export. Don‚Äôt let your competitors grab these first.</p>

  <form method="post" action="/start-checkout" style="margin-top: 12px;">
  <input name="email" type="email" placeholder="Work email for Pro access" required
         style="max-width:420px; margin: 0 auto 10px; display:block;" />
  <button id="upgradeBtnTop" type="submit">Unlock SignalZip Pro</button>
  </form>


    <div class="locked-strip">
      <div class="lockpill">Unlimited scans</div>
      <div class="lockpill">Full ranked list</div>
      <div class="lockpill">CSV export</div>
      <div class="lockpill">Faster targeting</div>
    </div>

    <div class="small">
      (Today this is a demo premium toggle. Replace /upgrade with Stripe Checkout when ready.)
    </div>
  </div>
{% endif %}



<script>
  // Slower scanner UI (very slow fallback)
  const form = document.getElementById("scanForm");
  const overlay = document.getElementById("scannerOverlay");
  const scanBarInner = document.querySelector(".scanBar > div");
  const scanSteps = Array.from(document.querySelectorAll(".scanSteps .step"));

  function startScanAndSubmit(e) {
    e.preventDefault();
    if (!form) return;

    overlay.style.display = "flex";
    scanSteps.forEach(s => s.classList.remove("done"));
    if (scanBarInner) {
      scanBarInner.style.transition = "none";
      scanBarInner.style.width = "2%";
    }

    const thresholds = [0.12, 0.40, 0.72, 0.92];
    const slowDuration = 6000000; // 100 minutes (10x slower than previous 10-minute fallback)
    let lastUploadPct = 0;
    let progress = 0;
    let intervalId = null;
    const stepTimeouts = [];

    function setProgress(pct) {
      progress = Math.min(1, Math.max(progress, pct));
      const width = 2 + 98 * progress; // start near 2%
      if (scanBarInner) {
        scanBarInner.style.transition = "width 72000ms linear";
        scanBarInner.style.width = width + "%";
      }
      for (let i = 0; i < scanSteps.length; i++) {
        if (progress >= (thresholds[i] || 1)) {
          scanSteps[i].classList.add("done");
        }
      }
    }

    // schedule extremely slow timed completions for each step
    for (let i = 0; i < thresholds.length; i++) {
      const t = thresholds[i];
      const ms = Math.round(slowDuration * t);
      stepTimeouts.push(setTimeout(() => {
        scanSteps[i].classList.add("done");
        setProgress(Math.max(progress, t + 0.005));
      }, ms));
    }

    const startTime = Date.now();
    intervalId = setInterval(() => {
      const elapsed = Date.now() - startTime;
      const est = Math.min(0.99, elapsed / slowDuration);
      const visible = Math.max(est, lastUploadPct, progress);
      setProgress(visible);
      if (visible >= 0.99) {
        clearInterval(intervalId);
        intervalId = null;
      }
    }, 1000); // update once per second (sufficient for extremely slow animation)

    const xhr = new XMLHttpRequest();
    xhr.open("POST", form.action);
    xhr.withCredentials = true;
    const fd = new FormData(form);

    xhr.upload.onprogress = (ev) => {
      if (ev.lengthComputable) {
        lastUploadPct = ev.loaded / ev.total;
        setProgress(lastUploadPct);
      }
    };

    xhr.onreadystatechange = () => {
      if (xhr.readyState === 4) {
        if (intervalId) { clearInterval(intervalId); intervalId = null; }
        stepTimeouts.forEach(id => clearTimeout(id));
        setProgress(1);
        scanSteps.forEach(s => s.classList.add("done"));
        setTimeout(() => {
          try {
            document.open();
            document.write(xhr.responseText);
            document.close();
          } catch (err) {
            if (xhr.responseURL) window.location.href = xhr.responseURL;
            else overlay.style.display = "none";
          }
        }, 600);
      }
    };

    xhr.onerror = () => {
      if (intervalId) { clearInterval(intervalId); intervalId = null; }
      stepTimeouts.forEach(id => clearTimeout(id));
      setProgress(1);
      scanSteps.forEach(s => s.classList.add("done"));
      setTimeout(() => {
        overlay.style.display = "none";
        alert("Upload failed. Please try again.");
      }, 700);
    };

    xhr.send(fd);
  }

  if (form) form.addEventListener("submit", startScanAndSubmit);

  // helpers
  function toggleCard(id) {
    const el = document.getElementById(id);
    if (!el) return;
    const hidden = el.style.display === "none" || getComputedStyle(el).display === "none";
    el.style.display = hidden ? "block" : "none";
    if (hidden) el.scrollIntoView({ behavior: "smooth", block: "center" });
  }

  document.addEventListener("click", async (e) => {
    const btn = e.target.closest("[data-copy]");
    if (!btn) return;
    const id = btn.getAttribute("data-copy");
    const el = document.getElementById(id);
    if (!el) return;
    try {
      await navigator.clipboard.writeText(el.innerText);
      const old = btn.innerText;
      btn.innerText = "Copied ‚úì";
      setTimeout(() => btn.innerText = old, 900);
    } catch {
      const range = document.createRange();
      range.selectNodeContents(el);
      const sel = window.getSelection();
      sel.removeAllRanges();
      sel.addRange(range);
      const old = btn.innerText;
      btn.innerText = "Select + Cmd+C";
      setTimeout(() => btn.innerText = old, 1200);
    }
  });
</script>

</body>
</html>
